<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/polymerfire/polymerfire.html">
<link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../bower_components/paper-fab/paper-fab.html">
<link rel="import" href="meetup-title.html">
<link rel="import" href="meetup-event.html">
<link rel="import" href="meetup-new-event.html">
<link rel="import" href="meetup-event-editor.html">

<dom-module id="meetup-events">
	<template>

		<style is="custom-style">
			section {
				@apply(--layout);
				@apply(--layout-wrap);
				@apply(--layout-center-justified);
				background-color: var(--light-gray);
			}

			paper-fab {
				--paper-fab-background: var(--secondary-color);
				--paper-fab-keyboard-focus-background: #104d82;
				position: fixed;
				bottom: 40px;
				right: 40px;
				z-index: 5;
			}
		</style>

		<firebase-document
			id="events"
			app-name="meetup"
			data="{{data}}">
		</firebase-document>

		<firebase-query
			id="eventsQuery"
			app-name="meetup"
			path="/events"
			data="{{queryData}}">
		</firebase-query>

		<meetup-title title="Events"></meetup-title>

		<paper-fab icon="add" label="New Event" on-tap="openNew"></paper-fab>

		<meetup-new-event
			id="newEvent"
			on-submit="submitInfo">
		</meetup-new-event>

		<meetup-event-editor id="editor"></meetup-event-editor>

		<section>
			<template id="event" is="dom-repeat" items="[[queryData]]" as="event" initial-count="1">
				<meetup-event
					event-name="[[event.title]]"
					event-type="[[event.type]]"
					event-host="[[event.host]]"
					event-image="[[event.image]]"
					event-start="[[event.start]]"
					event-end="[[event.end]]"
					event-guests="[[event.guests]]"
					event-location="[[event.location]]"
					event-info="[[event.info]]"
					event-id="[[event.$key]]"
					on-open="openEditor">
				</meetup-event>
			</template>
		</section>

	</template>
	<script>
		
	Polymer({

		is: 'meetup-events',

		properties: {
			myName: {
				type: String,
				value: 'Nick'
			},
			path: {
				type: String,
				notify: true
			},
			data: {
				type: Object
			}
		},

		submitInfo: function(e, detail) {
			var self = this;
			var info = e.detail;

			self.data = {
				title: info.title,
				image: info.image,
				type: info.type,
				host: info.host,
				start: info.start,
				end: info.end,
				guests: info.guests,
				location: info.location,
				info: info.info
			};

			self.$.events.save('/events');
		},

		openNew: function() {
			this.$.newEvent.open();
		},

		openEditor: function(e, detail) {
			this.$.editor.open(e.detail.eventId);
		}

	});

	</script>
</dom-module>